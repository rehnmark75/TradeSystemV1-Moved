-- Streamlit Configuration Management Database Schema
-- This creates the complete database structure for the configuration system

-- Enable UUID extension for unique identifiers
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- ============================================================================
-- CONFIGURATION TABLES
-- ============================================================================

-- Main configuration settings table
CREATE TABLE config_settings (
    id SERIAL PRIMARY KEY,
    setting_name VARCHAR(100) UNIQUE NOT NULL,
    setting_value TEXT NOT NULL,
    setting_type VARCHAR(20) NOT NULL CHECK (setting_type IN ('float', 'int', 'bool', 'string', 'list', 'json')),
    category VARCHAR(50) NOT NULL,
    description TEXT,
    min_value DECIMAL(10,4),
    max_value DECIMAL(10,4),
    valid_options JSON, -- For enum-type settings
    is_sensitive BOOLEAN DEFAULT FALSE, -- For API keys and passwords
    requires_restart BOOLEAN DEFAULT FALSE, -- Settings that need app restart
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Configuration change history
CREATE TABLE config_history (
    id SERIAL PRIMARY KEY,
    setting_name VARCHAR(100) NOT NULL,
    old_value TEXT,
    new_value TEXT,
    changed_by VARCHAR(100) NOT NULL,
    change_reason TEXT,
    changed_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY